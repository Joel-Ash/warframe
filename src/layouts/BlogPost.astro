---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';

type Props = CollectionEntry<'main'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<html lang="ko">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			main {
				width: calc(100% - 2em);
				max-width: 100%;
				margin: 0;
			}
			.hero-image {
				width: 100%;
			}
			.hero-image img {
				display: block;
				margin: 0 auto;
				border-radius: 12px;
				box-shadow: var(--box-shadow);
			}
			.prose {
				width: 720px;
				max-width: calc(100% - 2em);
				margin: auto;
				padding: 1em;

				/* âœ… ë‹¤í¬/ë¼ì´íŠ¸ ìë™ ëŒ€ì‘ */
				color: var(--text-main);
			}
			.title {
				margin-bottom: 1em;
				padding: 1em 0;
				text-align: center;
				line-height: 1;
			}
			.title h1 {
				margin: 0 0 0.5em 0;
				color: var(--text-strong);
			}
			.date {
				margin-bottom: 0.5em;
				color: rgb(var(--gray));
			}
			.last-updated-on {
				font-style: italic;
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			<article>
				<div class="hero-image">
					{heroImage && <Image width={1020} height={510} src={heroImage} alt="" />}
				</div>
				<div class="prose">
					<div class="title">
						<div class="date">
							<FormattedDate date={pubDate} />
							{
								updatedDate && (
									<div class="last-updated-on">
										Last updated on <FormattedDate date={updatedDate} />
									</div>
								)
							}
						</div>
						<h1>{title}</h1>
						<hr />
					</div>
					<slot />
				</div>
			</article>

			<style>
				/* ===== ë³¸ë¬¸ ì „ì²´ ===== */
				.prose {
					font-size: 1rem;
					line-height: 1.8;
				}

				/* ===== ì œëª© ê³„ì¸µ ===== */
				.prose h1 {
					font-size: 2rem;
					margin-top: 2rem;
				}

				.prose h2 {
					font-size: 1.5rem;
					margin-top: 2rem;
				}

				.prose h3 {
					font-size: 1.25rem;
					margin-top: 1.5rem;
				}

				/* ===== ë¦¬ìŠ¤íŠ¸ (ê¸°ë³¸ ë¶ˆë¦¿ ìœ ì§€) ===== */
				.prose ul {
					margin-left: 1.25em;
					margin-top: 0.5em;
					margin-bottom: 0.5em;
				}

				.prose ul li {
					margin: 0.3em 0;
				}
			</style>
		</main>

		<Footer />

		<!-- âœ… ì—¬ê¸°! í† ê¸€ ìŠ¤í¬ë¦½íŠ¸ (body ëë‚˜ê¸° ì§ì „ 1ë²ˆë§Œ) -->
		<script>
			(function () {
				const STORAGE_KEY = "theme";
				const root = document.documentElement;
				const btn = document.querySelector("[data-theme-toggle]");

				function getSystemTheme() {
					return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches
						? "dark"
						: "light";
				}

				function apply(theme) {
					if (theme === "system") {
						root.removeAttribute("data-theme");
					} else {
						root.setAttribute("data-theme", theme);
					}
					updateButton();
				}

				function getCurrentTheme() {
					return root.getAttribute("data-theme") || "system";
				}

				function updateButton() {
					if (!btn) return;

					const t = getCurrentTheme();
					const effective = t === "system" ? getSystemTheme() : t;

					const icon = btn.querySelector(".theme-toggle__icon");
					const text = btn.querySelector(".theme-toggle__text");

					if (effective === "dark") {
						if (icon) icon.textContent = â˜€ï¸";
						if (text) text.textContent = "ë¼ì´íŠ¸";
					} else {
						if (icon) icon.textContent = "ğŸŒ™";
						if (text) text.textContent = "ë‹¤í¬";
					}

					btn.setAttribute("aria-label", effective === "dark" ? "ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜" : "ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜");
				}

				// ì´ˆê¸° ì ìš©: ì €ì¥ê°’ â†’ ì—†ìœ¼ë©´ system
				const saved = localStorage.getItem(STORAGE_KEY) || "system";
				apply(saved);

				// systemì¼ ë•Œë§Œ ì‹œìŠ¤í…œ ë³€ê²½ ë°˜ì˜
				const mq = window.matchMedia("(prefers-color-scheme: dark)");
				if (mq && mq.addEventListener) {
					mq.addEventListener("change", function () {
						if (getCurrentTheme() === "system") updateButton();
					});
				}

				// í´ë¦­ í† ê¸€ (light <-> dark)
				if (btn) {
					btn.addEventListener("click", function () {
						const current = getCurrentTheme();
						const effective = current === "system" ? getSystemTheme() : current;
						const next = effective === "dark" ? "light" : "dark";

						localStorage.setItem(STORAGE_KEY, next);
						apply(next);
					});
				}
			})();
		</script>
	</body>
</html>
